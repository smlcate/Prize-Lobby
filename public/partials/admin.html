<div class="container">
  <h2>üõ†Ô∏è Admin Panel</h2>

  <div>
    <h3>Platform Fee Settings</h3>
    <form ng-submit="updateFee()">
      <label>Platform Fee %:</label>
      <input type="number" ng-model="fee" min="0" max="100" step="0.1" required />
      <button type="submit" class="btn btn-primary">Update</button>
    </form>
    <p ng-if="message" style="color: green;">{{ message }}</p>
    <p ng-if="error" style="color: red;">{{ error }}</p>
  </div>
</div>

<hr>
<h3>Event Management</h3>
<div>
  <label>Filter by status:</label>
  <select ng-model="filterStatus">
    <option value="">All</option>
    <option value="pending">Pending</option>
    <option value="started">Started</option>
    <option value="completed">Completed</option>
  </select>
</div>

<table class="table">
  <thead>
    <tr>
      <th>Title</th>
      <th>Game</th>
      <th>Platform</th>
      <th>Status</th>
      <th>Prize Pool</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr ng-repeat="event in events | filter:{ status: filterStatus }">
      <td>{{ event.title }}</td>
      <td>{{ event.game }}</td>
      <td>{{ event.platform }}</td>
      <td>{{ event.status }}</td>
      <td>${{ (event.prize_pool / 100).toFixed(2) }}</td>
      <td>
        <button ng-if="event.status === 'pending'" class="btn btn-sm btn-warning" ng-click="startEvent(event.id)">Start</button>
        <button ng-if="event.status === 'started'" class="btn btn-sm btn-success" ng-click="completeEvent(event.id)">Complete</button>
      </td>
    </tr>
  </tbody>
</table>

<hr>
<h3>Withdrawal Requests</h3>

<table class="table">
  <thead>
    <tr>
      <th>User</th>
      <th>Amount</th>
      <th>Method</th>
      <th>Destination</th>
      <th>Status</th>
      <th>Requested</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr ng-repeat="w in withdrawals">
      <td>{{ w.email }}</td>
      <td>${{ (w.amount / 100).toFixed(2) }}</td>
      <td>{{ w.method }}</td>
      <td>{{ w.details }}</td>
      <td>{{ w.status }}</td>
      <td>{{ w.requested_at | date:'short' }}</td>
      <td>
        <button ng-if="w.status === 'pending'" class="btn btn-sm btn-success" ng-click="approveWithdrawal(w.id)">Approve</button>
        <button ng-if="w.status === 'pending'" class="btn btn-sm btn-danger" ng-click="rejectWithdrawal(w.id)">Reject</button>
      </td>
    </tr>
  </tbody>
</table>
<hr>
<h3>Export</h3>
<a class="btn btn-info" href="/api/admin/transactions/export" target="_blank">Download All Transactions (CSV)</a>
<a class="btn btn-info mt-3" href="/api/admin/withdrawals/export" target="_blank">
  Export Withdrawals (CSV)
</a>
